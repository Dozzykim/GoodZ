<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layouts/main_layout}">
<head>
    <title>결제 메인</title>
    <style>
        body {
            background-color: white;
        }
        .product-price {
            color: #d9534f;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .product-options, .buy-buttons, .size-info, .size-chart, .product-images, .related-products {
            margin-top: 20px;
        }
        .product-images img, .related-products img {
            width: 100px;
            height: auto;
            margin-right: 10px;
        }
        .size-info {
            display: flex;
            justify-content: flex-end;
        }
        .size-info img {
            width: 60%;
        }
        .related-products img {
            margin-right: 15px;
        }
        .carousel-control-prev, .carousel-control-next {
            width: 5%;
        }
        .chart-container {
            position: relative;
            margin-top: 20px;
        }
        .btn-purchase {
            background-color: #d9534f;
            color: white;
            border: none;
            width: 100%;
        }
        .btn-sell {
            background-color: #5cb85c;
            color: white;
            border: none;
            width: 100%;
        }
        .btn-wishlist {
            background-color: transparent;
            color: black;
            border: 1px solid #ddd;
            padding: 5px 10px;
            border-radius: 4px;
            width: 100%;
            text-align: center;
        }
        .btn-wishlist img {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
        .toggle-buttons {
            margin-bottom: 20px;
            text-align: center;
        }
        .toggle-buttons button {
            margin: 0 5px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body layout:fragment="content">
    <div class="mainContainer">
        <div class="container mt-5">
            <div class="row">
                <!-- 상품 상세 이미지 -->
                <div class="col-md-6">
                    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="/img/product/product_img.png" class="d-block w-100" alt="Stussy Basic T-Shirt 1">
                            </div>
                            <div class="carousel-item">
                                 <img src="/img/product/product_img.png" class="d-block w-100" alt="Stussy Basic T-Shirt 2">
                            </div>
                            <div class="carousel-item">
                                <img src="/img/product/product_img.png" class="d-block w-100" alt="Stussy Basic T-Shirt 3">
                            </div>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
                <!-- 상품 상세 정보 -->
                <div class="col-md-6">
                    <div class="product-details">
                        <h1>Stussy Basic Stussy T-Shirt Berry 2024</h1>
                        <div class="product-price">167,000원</div>
                        <div class="product-options">
                            <label for="size">Size:</label>
                            <select id="size" name="size" class="form-select w-50">
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                            </select>
                        </div>
                        <div class="buy-buttons mt-3">
                            <button class="btn btn-danger btn-purchase mb-2">구매 167,000원</button>
                            <button class="btn btn-success btn-sell mb-2">판매 56,000원</button>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-wishlist"><img src="/goodz/src/main/resources/static/img/관심 선택.png" alt="관심">관심</button>
                        </div>
                        <div class="chart">
                            <div class="chart-container">
                                <ul class="nav nav-tabs" id="priceTab" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="one-month-tab" data-bs-toggle="tab" href="#one-month" role="tab" aria-controls="one-month" aria-selected="true">1개월</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="three-months-tab" data-bs-toggle="tab" href="#three-months" role="tab" aria-controls="three-months" aria-selected="false">3개월</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="six-months-tab" data-bs-toggle="tab" href="#six-months" role="tab" aria-controls="six-months" aria-selected="false">6개월</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="one-year-tab" data-bs-toggle="tab" href="#one-year" role="tab" aria-controls="one-year" aria-selected="false">1년</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="all-time-tab" data-bs-toggle="tab" href="#all-time" role="tab" aria-controls="all-time" aria-selected="false">전체</a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane fade show active" id="one-month" role="tabpanel" aria-labelledby="one-month-tab">
                                        <canvas id="priceChart1Month"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="three-months" role="tabpanel" aria-labelledby="three-months-tab">
                                        <canvas id="priceChart3Months"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="six-months" role="tabpanel" aria-labelledby="six-months-tab">
                                        <canvas id="priceChart6Months"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="one-year" role="tabpanel" aria-labelledby="one-year-tab">
                                        <canvas id="priceChart1Year"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="all-time" role="tabpanel" aria-labelledby="all-time-tab">
                                        <canvas id="priceChartAllTime"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> <!-- 상품 상세 정보 (끝) -->
            </div>
            
            <!-- 사이즈 정보와 테이블을 같은 행에 배치 -->
            <div class="row mt-5">
                <div class="col-md-6 size-info">
                    <h5>Size Info</h5>
                    <img src="/img/product/size_info.png" alt="Size Chart">
                </div>
                <div class="col-md-6" id="sizeTableContainer">
                    <!-- 사이즈 테이블이 여기에 로드됨 -->
                </div>
            </div>

            <div class="container mt-4">
                <p class="userId fw-bold m-0">태그된 스타일</p>
                <div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-4 g-3" id="taggedStyles">
                    <!-- 반복문으로 최대 4개 까지 -->
                </div>
        
                <button id="loadMoreTagged" class="btn btn-primary mt-3 hidden">더보기</button>
        
                <p class="userId fw-bold m-0 mt-5">이 브랜드의 다른 상품</p>
                <div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-4 g-3" id="brandProducts">
                    <!-- 반복문으로 최대 4개 까지 -->
                </div>
        
                <button id="loadMoreBrand" class="btn btn-primary mt-3 hidden">더보기</button>
            </div>
        </div>
    </div>
    
    <script>
        function showCm() {
            document.querySelector('.cm-table').style.display = 'table';
            document.querySelector('.inches-table').style.display = 'none';
        }

        function showInches() {
            document.querySelector('.cm-table').style.display = 'none';
            document.querySelector('.inches-table').style.display = 'table';
        }

        document.addEventListener('DOMContentLoaded', function() {
            // 차트 데이터 설정
            const chartData = [200000, 220000, 210000, 230000, 250000];
            const labels = ['1개월', '3개월', '6개월', '1년', '전체'];
            const chartOptions = {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '가격 변동',
                        data: chartData,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            beginAtZero: true
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            // 차트 초기화
            const ctx1Month = document.getElementById('priceChart1Month').getContext('2d');
            const ctx3Months = document.getElementById('priceChart3Months').getContext('2d');
            const ctx6Months = document.getElementById('priceChart6Months').getContext('2d');
            const ctx1Year = document.getElementById('priceChart1Year').getContext('2d');
            const ctxAllTime = document.getElementById('priceChartAllTime').getContext('2d');
            
            new Chart(ctx1Month, chartOptions);
            new Chart(ctx3Months, chartOptions);
            new Chart(ctx6Months, chartOptions);
            new Chart(ctx1Year, chartOptions);
            new Chart(ctxAllTime, chartOptions);

            // 상품 종류에 따라 사이즈 테이블 로드
            const productType = 'clothing'; // 이 값을 동적으로 설정 가능
            if (productType === 'clothing') {
                fetch('product/size_table')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('sizeTableContainer').innerHTML = data;
                    });
            }

            // 초기 데이터 설정
            const taggedStylesData = [
                {
                    profileImg: "/img/product/profile.png",
                    userId: "zzang._.777",
                    postImg: "/img/product/style_card.png"
                },
                {
                    profileImg: "/img/product/profile.png",
                    userId: "zzang._.888",
                    postImg: "/img/product/style_card.png"
                }
            ];

            const brandProductsData = [
                {
                    postImg: "/img/product/product_card.png",
                    productName: "나이키 에어포스 미드원1"
                },
                {
                    postImg: "/img/product/product_card.png",
                    productName: "아디다스 슈퍼스타"
                },
                {
                    postImg: "/img/product/product_card.png",
                    productName: "뉴발란스 990"
                }
            ];

            function createTaggedStyleCard(data) {
                return `
                    <div class="col">
                        <div class="card border-0">
                            <div class="card-body">
                                <div class="card-text py-2">
                                    <div class="d-flex justify-content-start column-gap-1">
                                        <div class="profile-img">
                                            <img src="${data.profileImg}" alt="프로필이미지" class="rounded-circle">
                                        </div>
                                        <p class="userId fw-bold m-0">${data.userId}</p>
                                    </div>
                                </div>
                                <a href="#">
                                    <img src="${data.postImg}" alt="게시글" class="rounded-4" style="width: 100%;">
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }

            function createBrandProductCard(data) {
                return `
                    <div class="col">
                        <div class="card border-0">
                            <div class="card-body">
                                <a href="#">
                                    <img src="${data.postImg}" alt="게시글" class="rounded-4" style="width: 100%;">
                                </a>
                                <div class="card-text py-2">
                                    <div class="d-flex justify-content-start column-gap-1">
                                        <p class="userId fw-bold m-0">${data.productName}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function loadMore(containerId, data, createCard, limit) {
                const container = document.getElementById(containerId);
                const currentItems = container.getElementsByClassName('col').length;
                const nextItems = data.slice(currentItems, currentItems + limit);
                nextItems.forEach(item => {
                    container.innerHTML += createCard(item);
                });

                if (container.getElementsByClassName('col').length >= data.length) {
                    document.getElementById(`loadMore${containerId.charAt(0).toUpperCase() + containerId.slice(1)}`).classList.add('hidden');
                }
            }

            const initialLoadLimit = 4;

            loadMore('taggedStyles', taggedStylesData, createTaggedStyleCard, initialLoadLimit);
            loadMore('brandProducts', brandProductsData, createBrandProductCard, initialLoadLimit);

            document.getElementById('loadMoreTagged').addEventListener('click', () => {
                loadMore('taggedStyles', taggedStylesData, createTaggedStyleCard, initialLoadLimit);
            });

            document.getElementById('loadMoreBrand').addEventListener('click', () => {
                loadMore('brandProducts', brandProductsData, createBrandProductCard, initialLoadLimit);
            });

            // 처음 로드 시, 데이터 수에 따라 더보기 버튼 보이기
            if (taggedStylesData.length > initialLoadLimit) {
                document.getElementById('loadMoreTagged').classList.remove('hidden');
            }
            if (brandProductsData.length > initialLoadLimit) {
                document.getElementById('loadMoreBrand').classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
