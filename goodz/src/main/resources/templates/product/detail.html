<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layouts/product_layout}">
<head>
    <title>결제 메인</title>
    <style>
        body {
            background-color: white;
        }
        .product-price {
            color: #d9534f;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .product-options, .buy-buttons, .size-info, .size-chart, .product-images, .related-products {
            margin-top: 20px;
        }
        .product-images img, .related-products img {
            width: 100px;
            height: auto;
            margin-right: 10px;
        }
        .size-info {
            display: flex;
            justify-content: flex-end;
        }
        .size-info img {
            width: 60%;
        }
        .related-products img {
            margin-right: 15px;
        }
        .carousel-control-prev, .carousel-control-next {
            width: 5%;
        }
        .chart-container {
            position: relative;
            margin-top: 20px;
        }
        .btn-purchase {
            background-color: #d9534f;
            color: white;
            border: none;
            width: 100%;
            height: 50px;
        }
        .btn-sell {
            background-color: #5cb85c;
            color: white;
            border: none;
            width: 100%;
            height: 50px;
        }
        .btn-wish {
            background-color: transparent;
            color: black;
            border: 1px solid #ddd;
            padding: 5px 10px;
            border-radius: 4px;
            width: 100%;
            height: 60px;
            text-align: center;
        }
        .toggle-buttons {
            display: flex;
            margin-bottom: 20px;
            text-align: center;
        }
        .toggle-buttons button {
            justify-content: left;
            margin: 0 5px;
            color: black;
            background-color: white;
            border: none;
        }
        .hidden {
            display: none;
        }
        
        .divider {
            width: 2px;
            height: 30px; /* 원하는 길이로 변경하세요 */
            background-color: black; /* 원하는 색상으로 변경하세요 */
            margin: 0 10px; /* 버튼과 구분선 사이의 간격 조절 */
        }

        .nav-pills .nav-link {
            border-radius: 15px;
            background-color: #f8f9fa;
            margin: 0 5px;
            color: #495057;
            font-weight: bold;
            text-align: center;
        }

        .nav-pills .nav-link.active {
            background-color: #007bff;
            color: white;
        }

        .nav-pills .nav-link:hover {
            background-color: #e2e6ea;
            color: #007bff;
        }

        .chart-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .modal {
            z-index: 1055 !important;
        }       

        .modal-content {
            text-align: center;
        }
        
        .modal-content .btn {
            width: 100px;
            margin: 5px;
        }

        .shipping_info img {
            width: 50px;
            height: 20%;
            margin-right: 25px;
        }
    </style>
</head>
<body layout:fragment="content">
    
    <!-- for wishList -->
    <th:block th:if="${loginUser != null}">
        <input type="hidden" id="isLoggedIn" th:data-logged-in="${loginUser != null}">
        <input type="hidden" id="csrfToken" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <input type="hidden" name="userId" id="loginUserId" th:value="${loginUser.userId}">
    </th:block>

    <div class="mainContainer">
        <div class="container mt-5">
            <div class="row">
                <!-- 상품 상세 이미지 -->
                <div class="col-md-6">
                    <div id="carouselExampleIndicators" class="carousel slide">
                        <div class="carousel-indicators">
                            <th:block th:each="image, iterStat : ${images}">
                                <button type="button" data-bs-target="#carouselExampleIndicators" th:data-bs-slide-to="${iterStat.index}" 
                                        th:classappend="${iterStat.index == 0} ? 'active'" th:aria-current="${iterStat.index == 0} ? 'true' : null" 
                                        th:aria-label="'Slide ' + (${iterStat.index} + 1)"></button>
                            </th:block>
                        </div>
                        <div class="carousel-inner">
                            <th:block th:each="image, iterStat : ${images}">
                                <div th:class="'carousel-item' + (${iterStat.index == 0} ? ' active' : '')">
                                    <img th:src="@{/files/img(imgUrl=${image.filePath})}" th:alt="${image.filePath}">
                                </div>
                            </th:block>
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
                <!-- 상품 상세 정보 -->
                <div class="col-md-6">
                    <div class="product-details">
                        <h3 id="productName" th:text="${product.productName}"></h3>
                        <div class="product-price">
                            <p id="productPrice" class="m-0 ms-2" th:text="${formattedMinPrice}"></p>
                        </div>
                        
                        <input type="hidden" id="productNo" name="productNo" th:value="${product.pNo}">
                        <input type="hidden" id="category" name="category" th:value="${product.category}">
                        <input type="hidden" id="brand" name="brand" th:value="${product.bName}">
                        <input type="hidden" id="initialPrice" name="initialPrice" th:value="${product.initialPrice}">

                        <div class="product-options">
                            <button id="sizeButton" name="size" class="form-select w-100" data-bs-toggle="modal" data-bs-target="#sizeModal">
                                모든 사이즈
                            </button>
                        </div>
                        
                        <div class="p-1">
                            <div class="buy-buttons mt-3 d-flex justify-content-end">
                                <button class="btn btn-danger btn-purchase mb-2 me-2 d-flex justify-content-between align-items-center" 
                                        data-bs-toggle="modal" data-bs-target="#transactionModal" data-type="purchase" th:data-prices="${pricesJson}">
                                   구매 <p class="m-0 ms-2" th:if="${minPrice > 0}" th:text="${formattedMinPrice}"></p>
                                    </button>
                                <button class="btn btn-success btn-sell mb-2 me-2 d-flex justify-content-between align-items-center" 
                                        data-bs-toggle="modal" data-bs-target="#transactionModal" data-type="sell" 
                                        data-category="${product.category}" th:data-initial-price="${product.initialPrice}">
                                    판매 <p class="m-0 ms-2" id="initialPriceText"></p>
                                </button>
                            </div>
                            
                            <div class="mt-1 d-flex justify-content-center">
                                <button class="btn-wish" th:onclick="'btnWish(this, \'product\', ' + ${product.pNo} + ')'" style="color: black;">
                                    <svg xmlns="http://www.w3.org/2000/svg" th:fill="${isWishlisted} ? 'solid' : 'none'" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" width="26" height="26">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z" />
                                    </svg>
                                    <span class="wish-button">관심</span>
                                </button>
                            </div>
                        </div>

                        <!-- Size Modal -->
                        <div class="modal fade" id="sizeModal" tabindex="-1" aria-labelledby="sizeModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="sizeModalLabel">사이즈 선택</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- 사이즈 옵션이 여기에 동적으로 삽입됩니다 -->
                                        <th:block th:each="option : ${options}">
                                            <button class="btn btn-outline-secondary size-option" th:data-size="${option.size}" th:data-price="${option.optionPrice}" th:text="${option.size}"></button>
                                        </th:block>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-dark" id="confirmSizeButton">선택 완료</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Transaction Modal -->
                        <div class="modal fade" id="transactionModal" tabindex="-1" aria-labelledby="transactionModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="transactionModalLabel">거래하기</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- 사이즈와 가격 옵션이 여기에 동적으로 삽입됩니다 -->
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-dark" id="confirmTransactionButton">거래하기</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> <!-- 상품 상세 정보 (끝) -->
                    
                    <!-- 배송 방법 -->
                    <div class="section_unit mb-2">
                        <div class="section_content p-2">
                            <div class="shipping_info d-flex">
                                <img src="/img/pay/box.png" alt="배송박스" class="img-fluid" style="width: 50px; height: auto;"> <!-- 이미지 크기 조정 -->
                                <div class="shipping_detail d-flex flex-column ms-2"> <!-- 간격 조정 -->
                                    <div class="shipping_method small">일반배송 3,000원</div> <!-- 폰트 크기 조정 -->
                                    <div class="shipping_cost text-secondary small">
                                        검수 후 배송 | 9-11일 내 도착 예정
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                        <div class="chart">
                            <div class="chart-container">
                                <h5 class="text-md-start fw-bold" style="padding-right: 100px;">시세</h5>
                                <ul class="nav nav-tabs" id="priceTab" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="all-time-tab" data-bs-toggle="tab" href="#all-time" role="tab" aria-controls="all-time" aria-selected="true">전체</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="one-month-tab" data-bs-toggle="tab" href="#one-month" role="tab" aria-controls="one-month" aria-selected="false">1개월</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="three-months-tab" data-bs-toggle="tab" href="#three-months" role="tab" aria-controls="three-months" aria-selected="false">3개월</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="six-months-tab" data-bs-toggle="tab" href="#six-months" role="tab" aria-controls="six-months" aria-selected="false">6개월</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="one-year-tab" data-bs-toggle="tab" href="#one-year" role="tab" aria-controls="one-year" aria-selected="false">1년</a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane fade show active" id="all-time" role="tabpanel" aria-labelledby="all-time-tab">
                                        <canvas id="priceChartAllTime"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="one-month" role="tabpanel" aria-labelledby="one-month-tab">
                                        <canvas id="priceChart1Month"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="three-months" role="tabpanel" aria-labelledby="three-months-tab">
                                        <canvas id="priceChart3Months"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="six-months" role="tabpanel" aria-labelledby="six-months-tab">
                                        <canvas id="priceChart6Months"></canvas>
                                    </div>
                                    <div class="tab-pane fade" id="one-year" role="tabpanel" aria-labelledby="one-year-tab">
                                        <canvas id="priceChart1Year"></canvas>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div> <!-- 상품 상세 정보 (끝) -->
            </div>
            
            <!-- 사이즈 정보와 테이블을 같은 행에 배치 -->
            <div class="row mt-5 chart-container">
                <h5 class="text-md-start fw-bold" style="padding-right: 100px;">Size Info</h5>
                <div class="col-12 col-md-6 d-flex flex-column align-items-md-end size-info">
                    <img src="/img/product/size_info.png" alt="Size Chart" class="w-60 w-md-60" style="padding-right: 50px;">
                </div>
                <div class="col-12 col-md-6" id="sizeTableContainer">
                    <!-- 사이즈 테이블이 여기에 로드됨 -->
                </div>
            </div>

            <div class="container mt-4">
                <h5 class="text-md-start fw-bold mt-5" style="padding-right: 100px;">태그된 스타일</h5>
                <div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-4 g-3" id="taggedStyles">
                    <!-- 반복문으로 최대 4개 까지 -->
                    <div class="col">
                        <div class="card border-0">
                            <div class="card-body">
                                <div class="card-text py-2">
                                    <div class="d-flex justify-content-start column-gap-1">
                                        <div class="profile-img">
                                            <img src="/img/product/profile.png" alt="프로필이미지" class="rounded-circle">
                                        </div>
                                        <!-- 게시글 주인의 피드 -->
                                        <a href="" style="text-decoration-line: none; color: black;" >
                                            <p class="userId fw-bold m-0">박은서</p>
                                        </a>
                                    </div>
                                </div>
                                <a href="#">
                                    <img src="/img/product/style_card.png" alt="게시글" class="rounded-4" style="width: 100%;">
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="container mt-4">
                    <h5 class="text-md-start fw-bold mt-5">이 브랜드의 다른 상품</h5>
                    <div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-4 g-3" id="brandProducts">
                        <!-- 반복문으로 최대 4개 까지 -->
                        
                    </div>
                    <p id="noProductsMessage" style="display: none;"> 
                        <br><br> <strong>조회된 상품이 없습니다.</strong>
                        <br><br>
                    </p>

                </div>
            </div>
        </div>
    </div>
    
    <script>
        const sellButton = document.querySelector('.btn-sell');
        if (sellButton) {
            const initialPrice = parseFloat(document.getElementById('initialPrice').value);
            if (!isNaN(initialPrice)) {
                const discountedPrice = Math.floor((initialPrice * 0.9) / 10) * 10;
                document.getElementById('initialPriceText').textContent = discountedPrice.toLocaleString() + ' 원';
            } else {
                console.error('Initial price is not a valid number');
            }
        } else {
            console.error('Sell button not found');
        }

        function showCm() {
            document.querySelector('.cm-table').style.display = 'table';
            document.querySelector('.inches-table').style.display = 'none';
        }

        function showInches() {
            document.querySelector('.cm-table').style.display = 'none';
            document.querySelector('.inches-table').style.display = 'table';
        }

        document.addEventListener('DOMContentLoaded', function() {
            let selectedSize = '';
            let selectedPrice = '';
            let transactionType = '';
            let discountedPrice = 0;

            const sizeButton = document.getElementById('sizeButton');
            const sizeModal = document.getElementById('sizeModal');
            const sizeOptions = sizeModal.querySelectorAll('.size-option');
            const confirmSizeButton = document.getElementById('confirmSizeButton');
            const purchaseButton = document.querySelector('.btn-purchase'); // 구매 버튼 요소
            const purchasePriceElement = purchaseButton.querySelector('.m-0.ms-2'); // 구매 버튼 가격 텍스트 요소
            const productPriceElement = document.getElementById('productPrice'); // 상품 가격 텍스트 요소

            // Size 선택 모달에서 사이즈 버튼 클릭 이벤트
            sizeOptions.forEach(button => {
                button.addEventListener('click', function() {
                    // 모든 버튼의 활성화 상태를 초기화
                    sizeOptions.forEach(btn => btn.classList.remove('active'));
                    // 클릭된 버튼을 활성화
                    this.classList.add('active');
                    // 선택된 사이즈 저장
                    selectedSize = this.dataset.size;
                    selectedPrice = this.dataset.price; // 선택된 사이즈의 가격 저장
                });
            });

            // Size 선택 모달에서 사이즈 버튼 클릭 이벤트
            sizeModal.addEventListener('show.bs.modal', function(event) {
                const sizeOptions = sizeModal.querySelectorAll('.size-option');
                if (sizeOptions.length === 0) {
                    alert('구매 가능한 사이즈가 없습니다.');
                    event.preventDefault(); // 모달 창 열림 방지
                    return;
                }
            });

            // Size 선택 모달에서 선택 완료 버튼 클릭 이벤트
            confirmSizeButton.addEventListener('click', function() {
                if (selectedSize && selectedPrice) {
                    sizeButton.textContent = selectedSize;
                    purchasePriceElement.textContent = selectedPrice + ' 원'; // 구매 버튼 가격 업데이트
                    productPriceElement.textContent = selectedPrice + ' 원'; // 상품 가격 업데이트
                    var modal = bootstrap.Modal.getInstance(sizeModal);
                    modal.hide();
                } else {
                    alert('사이즈를 선택해주세요.');
                }
            });

            const modal = document.getElementById('transactionModal');
            // Transaction Modal 이벤트 리스너
            modal.addEventListener('show.bs.modal', function(event) {
                const button = event.relatedTarget; // 모달을 트리거한 버튼
                transactionType = button.getAttribute('data-type'); // 거래 타입 (구매 또는 판매)
                let prices = button.getAttribute('data-prices');
                const modalTitle = transactionType === 'purchase' ? '구매하기' : '판매하기';
                
                // 모달 제목 변경
                modal.querySelector('.modal-title').textContent = modalTitle;

                // 모달 바디 내용 초기화
                const modalBody = modal.querySelector('.modal-body');
                modalBody.innerHTML = '';

                if (transactionType === 'purchase') {
                    prices = JSON.parse(prices); // 구매의 경우 JSON 객체

                    // 가격 객체가 비어 있으면 알림 메시지 표시하고 모달 창 열지 않음
                    if (Object.keys(prices).length === 0) {
                        alert('구매 가능한 사이즈가 없습니다.');
                        event.preventDefault(); // 모달 창 열림 방지
                        return;
                    }

                    // 사이즈와 가격 버튼 생성
                    Object.keys(prices).forEach(size => {
                        const price = prices[size];
                        const button = document.createElement('button');
                        button.className = 'btn btn-outline-secondary purchase-option';
                        button.dataset.size = size;
                        button.dataset.price = price;
                        button.innerHTML = `${size}<br>${parseInt(price).toLocaleString()}원`;
                        modalBody.appendChild(button);
                    });
                } else {
                    const category = document.getElementById('category').value;
                    const initialPrice = parseFloat(document.getElementById('initialPrice').value);

                    let sizes = [];
                    if (category === 'shoes') {
                        sizes = [220, 230, 240, 250, 260, 270, 280];
                    } else if (category === 'top' || category === 'pants') {
                        sizes = ['XS', 'S', 'M', 'L', 'XL', 'XXL'];
                    } else {
                        sizes = ['free'];
                    }

                    // 사이즈 버튼 생성 (판매의 경우 가격은 발매가 * 0.9)
                    sizes.forEach(size => {
                        const button = document.createElement('button');
                        button.className = 'btn btn-outline-secondary purchase-option';
                        button.dataset.size = size;

                        // 판매 가격 계산
                        discountedPrice = Math.floor((initialPrice * 0.9) / 10) * 10;
                        button.dataset.price = discountedPrice;
                        button.innerHTML = `${size}<br>${discountedPrice.toLocaleString()}원`;
                        modalBody.appendChild(button);
                    });
                }

                // 각 버튼에 클릭 이벤트 리스너 추가
                modal.querySelectorAll('.purchase-option').forEach(btn => {
                    btn.addEventListener('click', function() {
                        // 모든 버튼의 활성화 상태를 초기화
                        modal.querySelectorAll('.purchase-option').forEach(b => b.classList.remove('active'));
                        // 클릭된 버튼을 활성화
                        this.classList.add('active');
                        // 선택된 사이즈와 가격 저장
                        selectedSize = this.dataset.size;
                        selectedPrice = this.dataset.price;
                    });
                });
            });

            // 거래하기 버튼 클릭 이벤트 리스너 추가
            document.getElementById('confirmTransactionButton').addEventListener('click', function() {
                if (selectedSize && selectedPrice) {
                    // 선택된 사이즈와 가격으로 거래 요청을 보냄
                    console.log(`거래 요청: 타입 - ${transactionType}, 사이즈 - ${selectedSize}, 가격 - ${selectedPrice}`);

                    const productNo = document.getElementById('productNo').value;

                    // GET 요청을 보내고 페이지를 이동
                    let url;
                    if (transactionType === 'purchase') {
                        url = new URL(`/pay/buy/${productNo}`, window.location.origin);
                        url.searchParams.append('price', selectedPrice);                        
                    } else {
                        url = new URL(`/pay/sell/${productNo}`, window.location.origin);
                        url.searchParams.append('price', discountedPrice);
                    }
                    url.searchParams.append('size', selectedSize);
                    window.location.href = url;
                } else {
                    alert('사이즈를 선택해주세요.');
                }
            });

            // 차트 데이터 설정
            const chartData = [200000, 220000, 210000, 230000, 250000];
            const labels = ['1개월', '3개월', '6개월', '1년', '전체'];
            const chartOptions = {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '가격 변동',
                        data: chartData,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            beginAtZero: true
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            // 차트 초기화
            const ctxAllTime = document.getElementById('priceChartAllTime').getContext('2d');
            const ctx1Month = document.getElementById('priceChart1Month').getContext('2d');
            const ctx3Months = document.getElementById('priceChart3Months').getContext('2d');
            const ctx6Months = document.getElementById('priceChart6Months').getContext('2d');
            const ctx1Year = document.getElementById('priceChart1Year').getContext('2d');
            
            new Chart(ctxAllTime, chartOptions);
            new Chart(ctx1Month, chartOptions);
            new Chart(ctx3Months, chartOptions);
            new Chart(ctx6Months, chartOptions);
            new Chart(ctx1Year, chartOptions);

            // 상품 종류에 따라 사이즈 테이블 로드
            const productType = 'clothing'; // 이 값을 동적으로 설정 가능
            if (productType === 'clothing') {
                fetch('/product/detail/product/size_table')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('sizeTableContainer').innerHTML = data;
                    });
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            let page = 0;
            const size = 4;
            const maxPages = 10;
            const brandProductsContainer = document.getElementById('brandProducts');
            const noProductsMessage = document.getElementById('noProductsMessage');
            let allProductsLoaded = false;
            const loadedProducts = new Set();

            const loadMoreProducts = () => {
                if (allProductsLoaded || page >= maxPages) return;

                const brand = encodeURIComponent(document.getElementById('brand').value);
                const category = document.getElementById('category').value;
                const pNo = document.getElementById('productNo').value;

                fetch(`/product/brand/products?page=${page}&size=${size}&brand=${brand}&category=${category}&pNo=${pNo}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.length === 0 && page === 0) {
                            noProductsMessage.style.display = 'block';
                        } else {
                            noProductsMessage.style.display = 'none';
                        }

                        if (data.length < size) {
                            allProductsLoaded = true;
                        }

                        if (data.length > 0) {
                            data.forEach(product => {

                            if (product.productName !== undefined && !loadedProducts.has(product.productName)) {
                                loadedProducts.add(product.productName);

                                const col = document.createElement('div');
                                col.classList.add('col');

                                const card = `
                                    <div class="card border-0">
                                        <div class="card-body">
                                            <a href="/product/detail/${product.pNo}">
                                                <img src="/files/img?imgUrl=${encodeURIComponent(product.imageUrl)}" alt="상품 이미지" class="rounded-4 w-100">
                                            </a>
                                            <div class="card-text py-2">
                                                <div class="d-flex justify-content-start column-gap-1">
                                                    <p class="user-id fw-bold m-0">${product.productName}</p>
                                                </div>
                                                <div class="d-flex justify-content-start column-gap-1">
                                                    <p id="productPrice" class="m-0 ms-2">${product.formattedMinPrice}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                col.innerHTML = card;
                                brandProductsContainer.appendChild(col);
                            }
                            });
                            page++;
                        }
                    })
                    .catch(error => console.error('Error:', error));
            };

            const handleScroll = () => {
                if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 800) {
                    loadMoreProducts();
                }
            };

            window.addEventListener('scroll', handleScroll);
            loadMoreProducts();
        });

    </script>
</body>
</html>
